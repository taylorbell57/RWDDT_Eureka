# Template for RW-DDT Jupyter container (SIMPLE MODE)
# Replace <project_name>, <uid>, <gid>, <hostport>, <crds_dir>, <crds_target>, <crds_bind_mode>, and <crds_path>.
# Do not commit generated docker-compose.yml files; they contain local absolute paths.

name: <project_name>

services:
  rwddt_eureka:
    # Prefer a tagged image for reproducibility; override via IMAGE env if desired
    image: ${IMAGE:-tbell664/rwddt_eureka:latest}

    # For local development (uncomment to build locally instead of pulling):
    # build:
    #   context: .
    #   args:
    #     NB_UID: ${UID:-1000}
    #     NB_GID: ${GID:-1000}
    #     EUREKA_REF: ${EUREKA_REF:-3a67244}
    #     NOTEBOOKS_REPO: ${NOTEBOOKS_REPO:-https://github.com/taylorbell57/rocky-worlds-notebooks.git}
    #     NOTEBOOKS_REF: ${NOTEBOOKS_REF:-3c97fa5}
    #     INCLUDE_NOTEBOOKS: ${INCLUDE_NOTEBOOKS:-true}

    init: true
    stop_signal: SIGINT
    stop_grace_period: 20s

    user: "<uid>:<gid>"

    ports:
      - "<hostport>:8888"

    # In simple mode, no host data directories are mounted by default.
    # CRDS is still mounted so tools can work as expected (optional but recommended).
    volumes:
      - <crds_dir>:<crds_target>:<crds_bind_mode>

    environment:
      TZ: ${TZ:-UTC}

      # Force Simple Mode workspace inside container
      SIMPLE_MODE: "1"

      CRDS_MODE: ${CRDS_MODE:-local}
      CRDS_PATH: ${CRDS_PATH:-<crds_path>}

      CONDA_CHANGEPS1: "no"
      HOST_PORT: <hostport>

      # Leave dataset variables blank in Simple Mode
      PLANET: ""
      VISIT: ""
      ANALYST: ""

    restart: unless-stopped

